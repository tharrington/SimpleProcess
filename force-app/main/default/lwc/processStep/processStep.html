<template>
    <lightning-card title="Enroll Process">
        <div class="slds-p-around_medium">
            <lightning-combobox
                label="Select Process Template"
                options={templates}
                value={selectedTemplateId}
                onchange={handleTemplateChange}>
            </lightning-combobox>

            <br/>

            <lightning-button
                label="Enroll Process"
                variant="brand"
                class="slds-m-top_medium"
                onclick={handleCreate}
                disabled={isCreateDisabled}>
            </lightning-button>
        </div>
    </lightning-card>

    <br class="slds-m-top_large"/>

    <lightning-card title="Running Workflows" class="slds-m-top_large">
        <div class="slds-p-around_medium">
            <template if:true={hasProcesses}>
                <template for:each={processData} for:item="proc">
                    <div key={proc.Id} class="slds-m-bottom_large">
                        <div class="slds-grid slds-grid_vertical-align-center slds-m-bottom_small">
                            <div class="slds-col">
                                <strong class="slds-text-heading_medium">{proc.ProcessTemplateId.Name}</strong>
                            </div>
                            <div class="slds-col_bump-left">
                                <lightning-combobox
                                    label="Status"
                                    data-id={proc.Id}
                                    value={proc.Status}
                                    options={statusOptions}
                                    onchange={handleStatusChange}>
                                </lightning-combobox>
                            </div>
                        </div>

                        <div class="slds-m-bottom_small">
                            <lightning-formatted-date-time
                                value={proc.Due_Date}
                                year="numeric"
                                month="short"
                                day="2-digit"
                                hour="2-digit"
                                minute="2-digit"
                                hour12="true">
                            </lightning-formatted-date-time>
                        </div>
                        
                        <!-- Direct children only -->
                        <template if:true={proc.children}>
                            <div class="slds-m-top_medium">
                                <template for:each={proc.children} for:item="child">
                                    <c-process-step-item 
                                        key={child.Id}
                                        process={child}
                                        status-options={statusOptions}
                                        onstatuschange={handleStatusChange}>
                                    </c-process-step-item>
                                </template>
                            </div>
                        </template>
                    </div>
                </template>
            </template>
            <template if:false={hasProcesses}>
                <p>No running workflows.</p>
            </template>
        </div>
    </lightning-card>
</template>